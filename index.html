
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Transporter Details September</title>
    <style>
        /* All your existing CSS styles remain the same */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: linear-gradient(135deg, #1e88e5, #0d47a1);
            color: white;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        .search-section {
            background-color: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
        }
        
        .search-form {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            align-items: center;
        }
        
        .form-group {
            flex: 1;
            min-width: 300px;
            position: relative;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2c3e50;
        }
        
        select, input {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        
        select:focus, input:focus {
            outline: none;
            border-color: #1e88e5;
            box-shadow: 0 0 0 3px rgba(30, 136, 229, 0.2);
        }
        
        button {
            background-color: #1e88e5;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: background-color 0.3s;
            margin-top: 25px;
        }
        
        button:hover {
            background-color: #1565c0;
        }
        
        .btn-secondary {
            background-color: #4caf50;
            margin-left: 10px;
        }
        
        .btn-secondary:hover {
            background-color: #388e3c;
        }
        
        .btn-print {
            background-color: #ff9800;
            margin-left: 10px;
        }
        
        .btn-print:hover {
            background-color: #f57c00;
        }
        
        .results-section {
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            display: none;
        }
        
        .results-header {
            background-color: #1e88e5;
            color: white;
            padding: 15px 20px;
            font-size: 1.2rem;
            font-weight: 600;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .results-content {
            padding: 25px;
        }
        
        .result-item {
            margin-bottom: 20px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eee;
        }
        
        .result-item:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }
        
        .result-title {
            font-weight: 600;
            color: #1e88e5;
            margin-bottom: 8px;
            font-size: 1.1rem;
        }
        
        .no-results {
            text-align: center;
            padding: 30px;
            color: #7f8c8d;
            font-style: italic;
        }
        
        .add-vendor-section {
            background-color: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-top: 30px;
            display: none;
        }
        
        .form-row {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .form-field {
            flex: 1;
            min-width: 250px;
        }
        
        .vehicle-numbers-container {
            margin-top: 15px;
        }
        
        .vehicle-number-input {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
            align-items: center;
        }
        
        .remove-vehicle {
            background-color: #f44336;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 4px;
            cursor: pointer;
        }
        
        .add-vehicle {
            background-color: #9e9e9e;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 4px;
            cursor: pointer;
            margin-top: 10px;
        }
        
        /* Search suggestions styling */
        .suggestions-container {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background-color: white;
            border: 1px solid #ddd;
            border-top: none;
            border-radius: 0 0 6px 6px;
            max-height: 200px;
            overflow-y: auto;
            z-index: 1000;
            display: none;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .suggestion-item {
            padding: 10px 15px;
            cursor: pointer;
            border-bottom: 1px solid #eee;
        }
        
        .suggestion-item:hover {
            background-color: #f5f5f5;
        }
        
        .suggestion-item:last-child {
            border-bottom: none;
        }
        
        .highlight {
            background-color: #e3f2fd;
            font-weight: bold;
        }
        
        /* Transport details table */
        .transport-details {
            margin-top: 30px;
        }
        
        .transport-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }
        
        .transport-table th, .transport-table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        
        .transport-table th {
            background-color: #f8f9fa;
            font-weight: 600;
            color: #2c3e50;
        }
        
        .transport-table tr:hover {
            background-color: #f5f5f5;
        }
        
        .summary {
            margin-top: 20px;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 6px;
            font-weight: 600;
        }
        
        .loading {
            text-align: center;
            padding: 20px;
            color: #1e88e5;
        }
        
        .warning {
            background-color: #fff3cd;
            color: #856404;
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 20px;
            border: 1px solid #ffeaa7;
        }
        
        @media (max-width: 768px) {
            .form-group, .form-field {
                min-width: 100%;
            }
            
            h1 {
                font-size: 2rem;
            }
            
            .form-row {
                flex-direction: column;
                gap: 15px;
            }
            
            .transport-table {
                display: block;
                overflow-x: auto;
            }
        }
        
        @media print {
            .search-section, .add-vendor-section, .btn-print {
                display: none;
            }
            
            .results-section {
                display: block !important;
                box-shadow: none;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>September Transport Billing System</h1>
        </header>
        
        <section class="search-section">
            <div class="search-form">
                <div class="form-group">
                    <label for="vehicleSearch">Search Vehicle Number:</label>
                    <input type="text" id="vehicleSearch" placeholder="Start typing vehicle number (e.g., AP39UJ)" autocomplete="off">
                    <div class="suggestions-container" id="suggestionsContainer"></div>
                </div>
            </div>
            
            <button type="button" onclick="searchVehicle()">Search Vehicle</button>
            <button type="button" class="btn-secondary" onclick="toggleAddVendorForm()">Add New Vendor</button>
        </section>
        
        <section class="results-section" id="resultsSection">
            <div class="results-header">
                <span>Vehicle Details</span>
                <button type="button" class="btn-print" onclick="printResults()">Print</button>
            </div>
            <div class="results-content" id="resultsContent">
                <!-- Results will be displayed here -->
            </div>
        </section>
        
        <section class="add-vendor-section" id="addVendorSection">
            <div class="results-header">Add New Vendor</div>
            <div class="results-content">
                <form id="vendorForm">
                    <div class="form-row">
                        <div class="form-field">
                            <label for="partyName">Party Name:</label>
                            <input type="text" id="partyName" required>
                        </div>
                        <div class="form-field">
                            <label for="accountNo">Account Number:</label>
                            <input type="text" id="accountNo" required>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-field">
                            <label for="bankName">Bank Name & Branch:</label>
                            <input type="text" id="bankName" required>
                        </div>
                        <div class="form-field">
                            <label for="beneficiary">Beneficiary:</label>
                            <input type="text" id="beneficiary" required>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-field">
                            <label for="pan">PAN Number:</label>
                            <input type="text" id="pan" required>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-field">
                            <label>Vehicle Numbers:</label>
                            <div class="vehicle-numbers-container" id="vehicleNumbersContainer">
                                <div class="vehicle-number-input">
                                    <input type="text" class="vehicleNumber" placeholder="Vehicle Number" required>
                                    <button type="button" class="remove-vehicle" onclick="removeVehicleField(this)">Remove</button>
                                </div>
                            </div>
                            <button type="button" class="add-vehicle" onclick="addVehicleField()">Add Another Vehicle</button>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <button type="button" onclick="addNewVendor()">Save Vendor</button>
                        <button type="button" class="btn-secondary" onclick="toggleAddVendorForm()">Cancel</button>
                    </div>
                </form>
            </div>
        </section>
    </div>

    <script>
        // Vehicle data
        let vehicleData = [
            {
                partyName: "YARA GOVIND RAO",
                accountNo: "29611100003742",
                bankName: "DCB Bank, Anakapalli",
                beneficiary: "YARA GOVIND RAO",
                pan: "AYBPY0969R",
                vehicleNumbers: ["AP39UY3435", "AP39UY3345"]
            },
            {
                partyName: "GADASALA SHIVA",
                accountNo: "1420155000065560",
                bankName: "KVB",
                beneficiary: "Gadasala Shiva",
                pan: "BTSPG7175G",
                vehicleNumbers: ["AP39WC2389", "AP39UQ2489"]
            },
            {
                partyName: "Sri Modamamba Transport",
                accountNo: "6086101003133",
                bankName: "CANARA BANK",
                beneficiary: "Ommi Madhu babu",
                pan: "ABEYO1294K",
                vehicleNumbers: ["AP39UZ3335"]
            },
            {
                partyName: "Sri Vijayalaxmi Transport",
                accountNo: "868457131",
                bankName: "Indian Bank,Anakapalle",
                beneficiary: "S K Santosh Kumar",
                pan: "CWUPS1379C",
                vehicleNumbers: ["AP39W4518"]
            },
            {
                partyName: "Sri Polnati Venkata Srinivas Rao",
                accountNo: "11040675260",
                bankName: "SBI, Anakapalle",
                beneficiary: "Polnati Venkata Srinivasrao",
                pan: "EMOPP4189M",
                vehicleNumbers: ["AP39UH2489"]
            },
            {
                partyName: "SRI MODHAMAMBA TRANSPORT",
                accountNo: "6546322059",
                bankName: "Indian Bank Anakapalle",
                beneficiary: "MONDEPU GOPI",
                pan: "GDAPM7595D",
                vehicleNumbers: []
            },
            {
                partyName: "SRI VARDHAN TRANSPORT",
                accountNo: "6086101005682",
                bankName: "CB Anakapalle",
                beneficiary: "PRIYANKA NAGULAPALLI",
                pan: "CCOPN9093G",
                vehicleNumbers: ["AP39W3579"]
            },
            {
                partyName: "SHREE NOOKAMBICA LORRY TRANSPORT",
                accountNo: "30893220505",
                bankName: "SBI, Anakapalle",
                beneficiary: "P.N.K.A Ananda Rao",
                pan: "CHOPP3166M",
                vehicleNumbers: ["AP39UF3245"]
            },
            {
                partyName: "LAKSHMI SRINIVASA TRANSPORT",
                accountNo: "053501505619",
                bankName: "ICICI, Anakapalle",
                beneficiary: "Gali Venkata Nukaraju",
                pan: "BQDPG9659K",
                vehicleNumbers: ["AP39W0505", "AP39WC7499"]
            },
            {
                partyName: "SRI MODAMAMBA LORRY TRANSPORT -POLNATI RAMU",
                accountNo: "039301000039226",
                bankName: "Indian Overseas Bank-Anakapalli",
                beneficiary: "POLNATI RAMU",
                pan: "AMEPP6405E",
                vehicleNumbers: ["AP39TV2536"]
            },
            {
                partyName: "POLNATI LAKSHMANA",
                accountNo: "20393866584",
                bankName: "SBI, Anakapalle",
                beneficiary: "POLNATI LAKSHMANA",
                pan: "EHGPP6721J",
                vehicleNumbers: ["AP39TV2537"]
            },
            {
                partyName: "GADASALA VENKATA RAO",
                accountNo: "41897007408",
                bankName: "SBI, Anakapalle",
                beneficiary: "GADASALA VENKATA RAO",
                pan: "BNLPG8819G",
                vehicleNumbers: []
            },
            {
                partyName: "Sri Durga Devi Lorry Services",
                accountNo: "30758927213",
                bankName: "SBI, Anakapalle",
                beneficiary: "N.Narisinga Rao",
                pan: "APCPN4125N",
                vehicleNumbers: []
            },
            {
                partyName: "Sri Balaji Transport",
                accountNo: "20286779205",
                bankName: "SBI",
                beneficiary: "Gangiredla Srinivasa Rao",
                pan: "BZJPG9951K",
                vehicleNumbers: ["AP39UE5163", "AP39VB2727", "AP39UP4799"]
            },
            {
                partyName: "BINDHU SREE TRANSPORT AND CONSTRUCTIONS",
                accountNo: "053505500548",
                bankName: "ICICI, Anakapalle",
                beneficiary: "NAMMI SUNITHA",
                pan: "BMHPB1489C",
                vehicleNumbers: []
            },
            {
                partyName: "Sri Venkata Durga Lorry service",
                accountNo: "50100398807876",
                bankName: "HDFC, Anakapalle",
                beneficiary: "Ullingala Nageswar Rao",
                pan: "CKQPN5200B",
                vehicleNumbers: ["AP39TN2579", "AP39UJ2669"]
            },
            {
                partyName: "Mummina Srinu",
                accountNo: "31897791454",
                bankName: "SBI",
                beneficiary: "Mummina Srinu",
                pan: "NIEPS1843A",
                vehicleNumbers: []
            },
            {
                partyName: "LANKA NAGESWARA RAO",
                accountNo: "386602010025075",
                bankName: "UNION BANK",
                beneficiary: "Lanka Nageswara Rao",
                pan: "AYWPL8780A",
                vehicleNumbers: ["AP39UU5665"]
            },
            {
                partyName: "R.K TRANSPORT",
                accountNo: "18862612000462",
                bankName: "PUNJAB NATIONAL BANK",
                beneficiary: "Ommi Venkata Rao",
                pan: "CACPV1217L",
                vehicleNumbers: ["AP39UG0559"]
            },
            {
                partyName: "SRI SIVA DURGA LORRY SERVICE",
                accountNo: "44005352428",
                bankName: "SBI, ANAKAPALLI",
                beneficiary: "Kommuri Durga Prasad",
                pan: "CKBPK7332L",
                vehicleNumbers: ["AP39WD8349"]
            },
            {
                partyName: "SRI MANIKANTA BALAJI LORRY TRANSPORT",
                accountNo: "33982901231",
                bankName: "SBI, Anakapalle",
                beneficiary: "M SOMUNAIDU",
                pan: "CLXPM8882N",
                vehicleNumbers: ["AP39WD4199"]
            },
            {
                partyName: "Sri Kanaka Durga LorrySERVICE",
                accountNo: "50100482507472",
                bankName: "HDFC, Anakapalle",
                beneficiary: "CH.POLANDRA",
                pan: "FRQPP2042K",
                vehicleNumbers: ["AP39UJ2399"]
            },
            {
                partyName: "K DURGA RAO",
                accountNo: "184010100508162",
                bankName: "AXIS BANK OF INDIA ANAKAPALLE",
                beneficiary: "K.DURGA RAO",
                pan: "BCBPR6347H",
                vehicleNumbers: ["AP31TN4302"]
            },
            {
                partyName: "SRI BALA DURGA LORRY SERVICE",
                accountNo: "36055252391",
                bankName: "SBI, Anakapalle",
                beneficiary: "J.SRI PADHAVALLAABHA",
                pan: "CCEPJ2049G",
                vehicleNumbers: ["AP39VF2339"]
            },
            {
                partyName: "SRI MODA VENKATA SURYA LORRY SERVICE",
                accountNo: "33808097568",
                bankName: "ANAKAPALLE",
                beneficiary: "POLNATI TATA RAO",
                pan: "BYEPP6263R",
                vehicleNumbers: ["AP39UC6939"]
            },
            {
                partyName: "Hanuman Lorry Service",
                accountNo: "42325671649",
                bankName: "Anakapalli",
                beneficiary: "T.Venkata Suresh",
                pan: "QSPPS5777F",
                vehicleNumbers: []
            },
            {
                partyName: "POLNATI ANNAPURNA",
                accountNo: "6086101003959",
                bankName: "CANARA BANK",
                beneficiary: "Polnati Annapuran",
                pan: "DWOPP2749J",
                vehicleNumbers: ["AP39WC9149", "AP39UP9239"]
            },
            {
                partyName: "SRI VIJAYA DURGA ENTERPRISES",
                accountNo: "31499967751",
                bankName: "SBI ANAKAPALLE",
                beneficiary: "VASADI RAMESH",
                pan: "AGNPV7563J",
                vehicleNumbers: []
            },
            {
                partyName: "VYSHNAVI LORRY TRANSPORT",
                accountNo: "053501507032",
                bankName: "ICICI, Anakapalle",
                beneficiary: "KARANAM A SRINIVASARAO",
                pan: "PJFPS1223C",
                vehicleNumbers: []
            }
        ];

        // Transport data
        let transportData = [];

        // Initialize the application
        function initApp() {
            setupSearchFunctionality();
            loadTransportData();
        }

        // Load transport data from GitHub
        async function loadTransportData() {
            try {
                const resultsContent = document.getElementById('resultsContent');
                resultsContent.innerHTML = '<div class="loading">Loading transport data...</div>';
                
                // GitHub raw URL for the Excel file
                const githubUrl = 'https://raw.githubusercontent.com/bimal-bp/trasport_vehicle_details/main/Sep_transport_bill.xlsx';
                
                // Fetch the Excel file
                const response = await fetch(githubUrl);
                if (!response.ok) {
                    throw new Error(`Failed to fetch data: ${response.status}`);
                }
                
                // Convert to blob
                const blob = await response.blob();
                
                // Read the Excel file
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        // Parse the Excel file
                        const data = new Uint8Array(e.target.result);
                        const workbook = XLSX.read(data, {type: 'array'});
                        
                        // Get the first sheet
                        const sheetName = workbook.SheetNames[0];
                        const worksheet = workbook.Sheets[sheetName];
                        
                        // Convert to JSON with date handling
                        const jsonData = XLSX.utils.sheet_to_json(worksheet, {
                            header: 1,
                            raw: false,
                            dateNF: 'yyyy-mm-dd' // Specify date format
                        });
                        
                        // Process the data
                        processTransportData(jsonData, worksheet);
                        
                        // Clear loading message
                        resultsContent.innerHTML = '';
                    } catch (error) {
                        console.error('Error processing Excel data:', error);
                        resultsContent.innerHTML = '<div class="no-results">Error loading transport data. Please try again later.</div>';
                    }
                };
                
                reader.readAsArrayBuffer(blob);
            } catch (error) {
                console.error('Error fetching transport data:', error);
                const resultsContent = document.getElementById('resultsContent');
                resultsContent.innerHTML = '<div class="no-results">Error loading transport data. Please try again later.</div>';
            }
        }

        // Process transport data
        function processTransportData(jsonData, worksheet) {
            if (!jsonData || jsonData.length < 2) {
                console.error('Invalid data format');
                return;
            }
            
            // Extract headers (first row)
            const headers = jsonData[0].map(header => header ? header.toString().trim() : '');
            
            // Process data rows
            transportData = [];
            for (let i = 1; i < jsonData.length; i++) {
                const row = jsonData[i];
                if (row && row.length > 0) {
                    const rowData = {};
                    headers.forEach((header, index) => {
                        if (header && row[index] !== undefined) {
                            // Handle date conversion for Accounting Date column
                            if (header === 'Accounting Date' && row[index]) {
                                rowData[header] = convertExcelDate(row[index]);
                            } else {
                                rowData[header] = row[index];
                            }
                        }
                    });
                    transportData.push(rowData);
                }
            }
            
            console.log('Transport data loaded:', transportData.length, 'records');
        }

        // Convert Excel serial date to JavaScript Date object
        function convertExcelDate(excelDate) {
            // If it's already a proper date string, return it
            if (typeof excelDate === 'string' && excelDate.includes('-')) {
                return excelDate;
            }
            
            // If it's a number (Excel serial date), convert it
            if (typeof excelDate === 'number') {
                // Excel date serial numbers start from January 1, 1900
                const excelEpoch = new Date(1900, 0, 1);
                // Subtract 2 days because Excel incorrectly considers 1900 as a leap year
                const jsDate = new Date(excelEpoch.getTime() + (excelDate - 2) * 24 * 60 * 60 * 1000);
                return jsDate.toISOString().split('T')[0]; // Return as YYYY-MM-DD
            }
            
            // If it's already a Date object, format it
            if (excelDate instanceof Date) {
                return excelDate.toISOString().split('T')[0];
            }
            
            // Return as is if we can't convert it
            return excelDate;
        }

        // Format date for display
        function formatDateForDisplay(dateValue) {
            if (!dateValue) return '';
            
            // If it's already a formatted date string, return it
            if (typeof dateValue === 'string' && dateValue.includes('-')) {
                const date = new Date(dateValue);
                if (!isNaN(date.getTime())) {
                    return date.toLocaleDateString('en-IN'); // Indian date format
                }
                return dateValue;
            }
            
            // If it's a Date object
            if (dateValue instanceof Date) {
                return dateValue.toLocaleDateString('en-IN');
            }
            
            // Return as is if we can't format it
            return dateValue;
        }

        // Set up search functionality
        function setupSearchFunctionality() {
            const searchInput = document.getElementById('vehicleSearch');
            const suggestionsContainer = document.getElementById('suggestionsContainer');
            
            // Event listener for input changes
            searchInput.addEventListener('input', function() {
                const searchTerm = this.value.trim().toUpperCase();
                
                // Clear suggestions if search term is empty
                if (searchTerm.length === 0) {
                    suggestionsContainer.style.display = 'none';
                    return;
                }
                
                // Get matching vehicle numbers from both vehicleData and transportData
                const matches = getMatchingVehicles(searchTerm);
                
                // Display suggestions
                displaySuggestions(matches, searchTerm);
            });
            
            // Event listener for clicks outside the search area
            document.addEventListener('click', function(e) {
                if (!searchInput.contains(e.target) && !suggestionsContainer.contains(e.target)) {
                    suggestionsContainer.style.display = 'none';
                }
            });
            
            // Event listener for keyboard navigation
            searchInput.addEventListener('keydown', function(e) {
                const suggestions = suggestionsContainer.querySelectorAll('.suggestion-item');
                const activeSuggestion = suggestionsContainer.querySelector('.suggestion-item.active');
                
                if (e.key === 'ArrowDown') {
                    e.preventDefault();
                    if (suggestions.length > 0) {
                        if (!activeSuggestion) {
                            suggestions[0].classList.add('active');
                        } else {
                            const currentIndex = Array.from(suggestions).indexOf(activeSuggestion);
                            const nextIndex = (currentIndex + 1) % suggestions.length;
                            activeSuggestion.classList.remove('active');
                            suggestions[nextIndex].classList.add('active');
                        }
                    }
                } else if (e.key === 'ArrowUp') {
                    e.preventDefault();
                    if (suggestions.length > 0 && activeSuggestion) {
                        const currentIndex = Array.from(suggestions).indexOf(activeSuggestion);
                        const prevIndex = (currentIndex - 1 + suggestions.length) % suggestions.length;
                        activeSuggestion.classList.remove('active');
                        suggestions[prevIndex].classList.add('active');
                    }
                } else if (e.key === 'Enter') {
                    e.preventDefault();
                    if (activeSuggestion) {
                        searchInput.value = activeSuggestion.textContent;
                        suggestionsContainer.style.display = 'none';
                        searchVehicle();
                    } else {
                        searchVehicle();
                    }
                }
            });
        }

        // Get matching vehicles based on search term
        function getMatchingVehicles(searchTerm) {
            const matches = [];
            
            // Get matches from vehicleData
            vehicleData.forEach(vehicle => {
                vehicle.vehicleNumbers.forEach(number => {
                    if (number && number.includes(searchTerm) && !matches.includes(number)) {
                        matches.push(number);
                    }
                });
            });
            
            // Get matches from transportData (vehicles that have transactions but no vendor details)
            if (transportData.length > 0) {
                transportData.forEach(record => {
                    const vehicleNo = record['VEHICLE NO'] ? record['VEHICLE NO'].toString().trim().toUpperCase() : '';
                    if (vehicleNo && vehicleNo.includes(searchTerm) && !matches.includes(vehicleNo)) {
                        matches.push(vehicleNo);
                    }
                });
            }
            
            // Sort matches by relevance (closer matches first)
            matches.sort((a, b) => {
                const aIndex = a.indexOf(searchTerm);
                const bIndex = b.indexOf(searchTerm);
                return aIndex - bIndex;
            });
            
            return matches;
        }

        // Display suggestions in the dropdown
        function displaySuggestions(matches, searchTerm) {
            const suggestionsContainer = document.getElementById('suggestionsContainer');
            
            // Clear previous suggestions
            suggestionsContainer.innerHTML = '';
            
            if (matches.length === 0) {
                suggestionsContainer.style.display = 'none';
                return;
            }
            
            // Create suggestion items
            matches.forEach(match => {
                const suggestionItem = document.createElement('div');
                suggestionItem.className = 'suggestion-item';
                suggestionItem.textContent = match;
                
                // Highlight the matching part
                const regex = new RegExp(searchTerm, 'gi');
                suggestionItem.innerHTML = match.replace(regex, '<span class="highlight">$&</span>');
                
                // Add click event
                suggestionItem.addEventListener('click', function() {
                    document.getElementById('vehicleSearch').value = match;
                    suggestionsContainer.style.display = 'none';
                    searchVehicle();
                });
                
                // Add hover effect
                suggestionItem.addEventListener('mouseover', function() {
                    // Remove active class from all suggestions
                    suggestionsContainer.querySelectorAll('.suggestion-item').forEach(item => {
                        item.classList.remove('active');
                    });
                    // Add active class to current suggestion
                    this.classList.add('active');
                });
                
                suggestionsContainer.appendChild(suggestionItem);
            });
            
            suggestionsContainer.style.display = 'block';
        }

        // Search function
        function searchVehicle() {
            const searchValue = document.getElementById('vehicleSearch').value.trim().toUpperCase();
            
            if (!searchValue) {
                alert('Please enter a vehicle number');
                return;
            }
            
            const results = vehicleData.filter(vehicle => 
                vehicle.vehicleNumbers.includes(searchValue)
            );
            
            displayResults(results, searchValue);
        }

        // Display results
        function displayResults(results, searchValue) {
            const resultsSection = document.getElementById('resultsSection');
            const resultsContent = document.getElementById('resultsContent');
            
            resultsContent.innerHTML = '';
            
            // Check if vehicle has transport records
            const hasTransportRecords = transportData.some(record => {
                const recordVehicleNo = record['VEHICLE NO'] ? record['VEHICLE NO'].toString().trim().toUpperCase() : '';
                return recordVehicleNo === searchValue;
            });
            
            if (results.length === 0) {
                if (hasTransportRecords) {
                    // Vehicle has transport records but no vendor details
                    const warningDiv = document.createElement('div');
                    warningDiv.className = 'warning';
                    warningDiv.innerHTML = `
                        <strong>Note:</strong> Vendor details not found for vehicle number: ${searchValue}. 
                        However, transport records are available below.
                    `;
                    resultsContent.appendChild(warningDiv);
                } else {
                    // No vendor details and no transport records
                    resultsContent.innerHTML = '<div class="no-results">No vendor details found for vehicle number: ' + searchValue + '</div>';
                }
            } else {
                // Display vendor details
                results.forEach(vehicle => {
                    const resultDiv = document.createElement('div');
                    resultDiv.className = 'result-item';
                    
                    resultDiv.innerHTML = `
                        <div class="result-title">Party Name: ${vehicle.partyName}</div>
                        <div><strong>Bank Account No.:</strong> ${vehicle.accountNo}</div>
                        <div><strong>Bank Name & Branch:</strong> ${vehicle.bankName}</div>
                        <div><strong>Beneficiary:</strong> ${vehicle.beneficiary}</div>
                        <div><strong>PAN:</strong> ${vehicle.pan}</div>
                        <div><strong>Vehicle Numbers:</strong> ${vehicle.vehicleNumbers.join(', ')}</div>
                    `;
                    
                    resultsContent.appendChild(resultDiv);
                });
            }
            
            // Always display transport details if available
            if (hasTransportRecords) {
                displayTransportDetails(searchValue);
            } else if (results.length > 0) {
                // If we have vendor details but no transport records
                const noTransportDiv = document.createElement('div');
                noTransportDiv.className = 'no-results';
                noTransportDiv.textContent = 'No transport records found for this vehicle.';
                resultsContent.appendChild(noTransportDiv);
            }
            
            resultsSection.style.display = 'block';
            
            // Scroll to results
            resultsSection.scrollIntoView({ behavior: 'smooth' });
        }

        // Display transport details
        function displayTransportDetails(vehicleNumber) {
            if (transportData.length === 0) {
                const loadingDiv = document.createElement('div');
                loadingDiv.className = 'loading';
                loadingDiv.textContent = 'Loading transport details...';
                document.getElementById('resultsContent').appendChild(loadingDiv);
                
                // Try to load data again if not available
                setTimeout(() => {
                    if (transportData.length === 0) {
                        loadTransportData().then(() => {
                            // After loading, try to display transport details again
                            const existingLoading = document.querySelector('.loading');
                            if (existingLoading) {
                                existingLoading.remove();
                            }
                            displayTransportDetails(vehicleNumber);
                        });
                    }
                }, 1000);
                return;
            }
            
            // Filter transport data for the vehicle
            const transportRecords = transportData.filter(record => {
                const recordVehicleNo = record['VEHICLE NO'] ? record['VEHICLE NO'].toString().trim().toUpperCase() : '';
                return recordVehicleNo === vehicleNumber;
            });
            
            if (transportRecords.length === 0) {
                return; // No transport records to display
            }
            
            // Create transport details section
            const transportDiv = document.createElement('div');
            transportDiv.className = 'transport-details';
            
            transportDiv.innerHTML = `
                <div class="result-title">Transport Details for Vehicle: ${vehicleNumber}</div>
                <table class="transport-table">
                    <thead>
                        <tr>
                            <th>Accounting Date</th>
                            <th>Customer Name</th>
                            <th>Vehicle No</th>
                            <th>Material</th>
                            <th>Net Weight</th>
                            <th>Transport Rate</th>
                            <th>Transport Amount</th>
                        </tr>
                    </thead>
                    <tbody id="transportTableBody">
                    </tbody>
                </table>
                <div class="summary" id="transportSummary">
                </div>
            `;
            
            document.getElementById('resultsContent').appendChild(transportDiv);
            
            // Populate table rows
            const tableBody = document.getElementById('transportTableBody');
            let totalAmount = 0;
            
            transportRecords.forEach(record => {
                const row = document.createElement('tr');
                
                // Format date properly
                const accountingDate = formatDateForDisplay(record['Accounting Date']);
                
                row.innerHTML = `
                    <td>${accountingDate}</td>
                    <td>${record['NAME OF THE CUSTOMER'] || ''}</td>
                    <td>${record['VEHICLE NO'] || ''}</td>
                    <td>${record['Material'] || ''}</td>
                    <td>${record['NET WT'] || ''}</td>
                    <td>${record['Transport Rate'] || ''}</td>
                    <td>${record['Transport Amount'] || ''}</td>
                `;
                
                tableBody.appendChild(row);
                
                // Calculate total amount
                const amount = parseFloat(record['Transport Amount']) || 0;
                totalAmount += amount;
            });
            
            // Display summary
            const summaryDiv = document.getElementById('transportSummary');
            summaryDiv.innerHTML = `
                Total Rows: ${transportRecords.length}<br>
                Total Transport Amount: ${totalAmount.toFixed(2)}
            `;
        }

        // Print results
        function printResults() {
            window.print();
        }

        // Toggle add vendor form
        function toggleAddVendorForm() {
            const addVendorSection = document.getElementById('addVendorSection');
            const resultsSection = document.getElementById('resultsSection');
            
            if (addVendorSection.style.display === 'block') {
                addVendorSection.style.display = 'none';
                document.getElementById('vendorForm').reset();
                // Reset to single vehicle field
                const container = document.getElementById('vehicleNumbersContainer');
                while (container.children.length > 1) {
                    container.removeChild(container.lastChild);
                }
            } else {
                addVendorSection.style.display = 'block';
                resultsSection.style.display = 'none';
                addVendorSection.scrollIntoView({ behavior: 'smooth' });
            }
        }

        // Add vehicle field
        function addVehicleField() {
            const container = document.getElementById('vehicleNumbersContainer');
            const newField = document.createElement('div');
            newField.className = 'vehicle-number-input';
            newField.innerHTML = `
                <input type="text" class="vehicleNumber" placeholder="Vehicle Number">
                <button type="button" class="remove-vehicle" onclick="removeVehicleField(this)">Remove</button>
            `;
            container.appendChild(newField);
        }

        // Remove vehicle field
        function removeVehicleField(button) {
            const container = document.getElementById('vehicleNumbersContainer');
            if (container.children.length > 1) {
                container.removeChild(button.parentNode);
            }
        }

        // Add new vendor
        function addNewVendor() {
            const partyName = document.getElementById('partyName').value.trim();
            const accountNo = document.getElementById('accountNo').value.trim();
            const bankName = document.getElementById('bankName').value.trim();
            const beneficiary = document.getElementById('beneficiary').value.trim();
            const pan = document.getElementById('pan').value.trim();
            
            // Get all vehicle numbers
            const vehicleInputs = document.querySelectorAll('.vehicleNumber');
            const vehicleNumbers = [];
            
            vehicleInputs.forEach(input => {
                const value = input.value.trim().toUpperCase();
                if (value) {
                    vehicleNumbers.push(value);
                }
            });
            
            // Validate required fields
            if (!partyName || !accountNo || !bankName || !beneficiary || !pan || vehicleNumbers.length === 0) {
                alert('Please fill in all required fields');
                return;
            }
            
            // Create new vendor object
            const newVendor = {
                partyName,
                accountNo,
                bankName,
                beneficiary,
                pan,
                vehicleNumbers
            };
            
            // Add to data array
            vehicleData.push(newVendor);
            
            // Show success message
            alert('Vendor added successfully!');
            
            // Reset form and hide it
            document.getElementById('vendorForm').reset();
            toggleAddVendorForm();
        }

        // Initialize the app when page loads
        window.onload = initApp;
    </script>
    
    <!-- Include SheetJS library for Excel file processing -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</body>
</html>
